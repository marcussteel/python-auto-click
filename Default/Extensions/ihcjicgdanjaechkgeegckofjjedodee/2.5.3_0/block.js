window.chrome=chrome||window.chrome||window.browser,window.chrome.runtime.getURL(""),(()=>{"use strict";Object.freeze({LicenseStateUnknown:0,LicenseStateFree:1,LicenseStateTrial:2,LicenseStateTrialExpired:3,LicenseStateLicensed:4,LicenseStateLicenseExpired:5,LicenseStateLicenseGrace:6});let e=window.chrome||window.browser||browser;navigator.userAgent.includes("Edge/")&&(e=window.browser),e.i18n.getUILanguage().split("-")[0];const s=(s,t=document)=>s.forEach((({id:s,msg:a,sub:r=null})=>{const n=t.getElementById(s);n&&(n.textContent=e.i18n.getMessage(a,r))}));Object.defineProperty({},"browser",{writable:!0}),Object.defineProperty({},"os",{writable:!0});const t=(e,s=2048)=>e.length>s?e.substr(0,s-1)+"...":e;console.debug("BLOCK PAGE");let a={};const r=e=>{console.debug("Add exclusions was successful. Will redirect to: ",e),window.location.href=`http://${n.url.split(/^https?:\/\//)[1]}`};a.typesAsPlural=e=>{switch(e){case"malware":case"ads":default:return e;case"scam":case"ad":return`${e}s`;case"pup":return"PUPs"}},a.templateParameters=()=>{let e={},s=new URLSearchParams(window.location.search);for(let t of s)"null"===t[1]?e[t[0]]=null:"undefined"===t[1]?e[t[0]]=void 0:e[t[0]]=t[1];return e};let n=a.templateParameters();console.debug("BLOCK PAGE PARAMS: ",n),a.getExclusionConst=e=>{switch(e){case"malware":return"EXCLUSION_MALWARE";case"scam":return"EXCLUSION_SCAMS";case"pup":return"EXCLUSION_PUPS";case"ad":case"ads":return"EXCLUSION_ADS";default:console.error("The block page exclusion checkbox has not handled '"+n.type+"'")}},a.updateAllowListViaMessage=(s,t)=>{if(t){let a=["full-url-malware","malware-pattern"].includes(s.subtype)||"specific"===s.rules?s.url:s.host;$("#mbbgb-continue-always").is(":checked")?(console.debug("Checkbox switched on - requesting allow for "+t),e.runtime.sendMessage({type:"MSG_ADD_ALLOW",payload:{host:a,allow:t}},(function(e){!e||e.error?console.error(e?e.error:"NO RESPONSE!"):r(s.url)}))):(console.debug("Checkbox switched off - requesting block for "+t),e.runtime.sendMessage({type:"MSG_REM_ALLOW_SINGLE",payload:{host:a,exclusion:t}},(function(e){!e||e.error?console.error(e?e.error:"NO RESPONSE!"):console.debug("Remove exclusions was successful")})))}},a.excludeTemporary=s=>{if(!$("#mb-do-not-block").checked)return new Promise((s=>{"undefined"!==n.tabId&&"null"!==n.tabId?s(n.tabId):e.tabs.query({currentWindow:!0,active:!0},(function(e){s(e[0].id)}))})).then((t=>{e.runtime.sendMessage({type:"MSG_ADD_ALLOW_TEMPORARY",host:n.host,initiator:t,exclusion:s},(function(e){return!e||e.error?Promise.reject(e?e.error:null):Promise.resolve(e.success)}))})).then((()=>{r(n.url)})).catch((e=>{console.error(e)})),!1},a.getExplanationText=()=>{switch(n.subtype){case"adware":return e.i18n.getMessage("blockExplainAdware");case"compromised":return e.i18n.getMessage("blockExplainCompromised");case"exploit":return e.i18n.getMessage("blockExplainExploit");case"fraud":return e.i18n.getMessage("blockExplainFradulent");case"hijack":return e.i18n.getMessage("blockExplainHijack");case"malvertising":return e.i18n.getMessage("blockExplainMalvertising");case"malware":return e.i18n.getMessage("blockExplainMalware");case"pharma":return e.i18n.getMessage("blockExplainPharma");case"phishing":return e.i18n.getMessage("blockExplainPhishing");case"pup":return e.i18n.getMessage("blockExplainPUP");case"ransomware":return e.i18n.getMessage("blockExplainRansomware");case"reputation":return e.i18n.getMessage("blockExplainReputation");case"riskware":return e.i18n.getMessage("blockExplainRiskware");case"scam":return e.i18n.getMessage("blockExplainScam");case"spam":return e.i18n.getMessage("blockExplainSpam");case"spyware":return e.i18n.getMessage("blockExplainSpyware");case"trojan":return e.i18n.getMessage("blockExplainTrojan");case"worm":return e.i18n.getMessage("blockExplainWorm");default:return e.i18n.getMessage("blockExplainDefault")}},a.getExplanationLink=()=>{switch(n.subtype){case"adware":return"https://www.malwarebytes.com/adware/?guard=1&x-source=threatlearn";case"compromised":return"https://blog.malwarebytes.com/glossary/compromised/?guard=1&x-source=threatlearn";case"exploit":return"https://blog.malwarebytes.com/glossary/exploit/?guard=1&x-source=threatlearn";case"fraud":return"https://blog.malwarebytes.com/glossary/fraud/?guard=1&x-source=threatlearn";case"hijack":return"https://blog.malwarebytes.com/glossary/hijack/?guard=1&x-source=threatlearn";case"malvertising":return"https://blog.malwarebytes.com/glossary/malvertising/?guard=1&x-source=threatlearn";case"pharma":return"https://blog.malwarebytes.com/glossary/pharma/?guard=1&x-source=threatlearn";case"phishing":return"https://blog.malwarebytes.com/glossary/phishing/?guard=1&x-source=threatlearn";case"pup":return"https://blog.malwarebytes.com/glossary/pup/?guard=1&x-source=threatlearn";case"ransomware":return"https://www.malwarebytes.com/ransomware/?guard=1&x-source=threatlearn";case"reputation":case"malware":default:return"https://blog.malwarebytes.com/glossary/malware/?guard=1&x-source=threatlearn";case"riskware":return"https://blog.malwarebytes.com/glossary/riskware/?guard=1&x-source=threatlearn";case"scam":return"https://blog.malwarebytes.com/glossary/scam/?guard=1&x-source=threatlearn";case"spam":return"https://blog.malwarebytes.com/glossary/spam/?guard=1&x-source=threatlearn";case"spyware":return"https://www.malwarebytes.com/spyware/?guard=1&x-source=threatlearn";case"suspiciousPage":case"suspiciousDownload":case"suspiciousContent":case"suspicious":return"https://blog.malwarebytes.com/glossary/suspicious-activity/?guard=1&x-source=threatlearn";case"suspiciousTLD":return"https://blog.malwarebytes.com/glossary/TLD/?guard=1&x-source=threatlearn";case"trojan":return"https://blog.malwarebytes.com/glossary/trojan/?guard=1&x-source=threatlearn";case"worm":return"https://blog.malwarebytes.com/glossary/worm/?guard=1&x-source=threatlearn"}},a.humanReadableSubType=()=>n.subtype?"full-url-malware"===n.subtype?"malware":"suspiciousPage"===n.subtype?e.i18n.getMessage("humanReadableSubTypeSuspiciousPage"):"suspiciousTLD"===n.subtype?e.i18n.getMessage("humanReadableSubTypeSuspiciousTLD"):"suspiciousDownload"===n.subtype?e.i18n.getMessage("humanReadableSubTypeSuspiciousDownload"):"suspiciousContent"===n.subtype?e.i18n.getMessage("humanReadableSubTypeSuspiciousContent"):"malware-pattern"===n.subtype?e.i18n.getMessage("humanReadableSubTypeMalwarePattern"):"alertLoop"===n.subtype?e.i18n.getMessage("humanReadableSubTypeAlertLoop"):"authRequiredLoop"===n.subtype?e.i18n.getMessage("humanReadableSubTypeAuthRequiredLoop"):"createURLLoop"===n.subtype?e.i18n.getMessage("humanReadableSubTypeCreateURLLoop"):"extensionInstall"===n.subtype?e.i18n.getMessage("humanReadableSubTypeExtensionInstall"):"fullScreenLoop"===n.subtype?e.i18n.getMessage("humanReadableSubTypeFullScreenLoop"):"historyLoop"===n.subtype?e.i18n.getMessage("humanReadableSubTypeHistoryLoop"):"notificationLoop"===n.subtype?e.i18n.getMessage("humanReadableSubTypeNotificationLoop"):"printLoop"===n.subtype?e.i18n.getMessage("humanReadableSubTypePrintLoop"):n.subtype:n.type;const o=()=>{const e=$("#mbbgb-continue-always").is(":checked");let s=a.getExclusionConst(n.type);e?a.updateAllowListViaMessage(n,s):a.excludeTemporary(s)};document.addEventListener("DOMContentLoaded",(function(){window.addEventListener("resize",(()=>{$("#mbbgb-inf").popup({inline:!0,hoverable:!0,lastResort:"bottom center"})})),$("#mbbgb-inf").popup({inline:!0,hoverable:!0,lastResort:"bottom center"}),s([{id:"blocked-by-title",msg:"blockedByTitle"},{id:"website-block-header",msg:"websiteBlockHeader"},{id:"mbbgb-block-description",msg:"defaultBlockExplanation",sub:n.type},{id:"mbbgb-block-warning",msg:"blockWarning"},{id:"mbbgb-back",msg:"blockGoBackButton"},{id:"mbbgb-continue-once",msg:"blockContinueButton"},{id:"warning",msg:"warning"},{id:"block-warning-line-1",msg:"blockWarningLine1"},{id:"block-warning-line-2",msg:"blockWarningLine2"},{id:"block-warning-line-3",msg:"blockWarningLine3"},{id:"support-link",msg:"supportLinkText"},{id:"mbbgb-continue-always-text",msg:"doNotBlockAgainCheckbox",sub:n.type},{id:"mbbgb-blocktype-desc",msg:"explainBlockHeader",sub:a.humanReadableSubType()},{id:"mbbgb-learn-even-more",msg:"learnMoreText"}]),["full-url-malware","malware-pattern"].includes(n.subtype)?(s([{id:"mbbgb-blocktype-sentence",msg:"blockPageText"}]),$("#mbbgb-site-name").text(t(n.url))):"suspiciousDownload"===n.subtype||"suspiciousContent"===n.subtype?(n.url?(s([{id:"mbbgb-blocktype-sentence",msg:"downloadBlockText"}]),$("#mbbgb-site-name").text(decodeURI(n.url))):n.host?(s([{id:"mbbgb-blocktype-sentence",msg:"downloadBlockText2"}]),$("#mbbgb-site-name").text(t(n.host))):null!=n.filename&&""!==n.filename?(s([{id:"mbbgb-blocktype-sentence",msg:"downloadBlockText"}]),$("#mbbgb-site-name").text(t(n.filename))):(s([{id:"mbbgb-blocktype-sentence",msg:"downloadBlockText2"}]),$("#mbbgb-site-name").text(t(n.host))),"suspiciousDownload"===n.subtype?s([{id:"mbbgb-block-description",msg:"suspiciousDownloadExplanation",sub:a.typesAsPlural(n.type)}]):s([{id:"mbbgb-block-description",msg:"suspiciousContentExplanation"}]),$("#mbbgb-block-warning").text("")):"suspiciousTLD"===n.subtype?(s([{id:"mbbgb-block-description",msg:"suspiciousTldExplanation"}]),$("#mbbgb-site-name").text(t(n.host)),$("#mbbgb-block-warning").text("")):"reputation"===n.subtype?(s([{id:"mbbgb-block-description",msg:"reputationBlockExplanation"}]),$("#mbbgb-site-name").text(t(n.host))):(s([{id:"mbbgb-blocktype-sentence",msg:"websiteBlockText"}]),$("#mbbgb-site-name").text(t(n.host))),$("#mbbgb-blocktype").text(a.humanReadableSubType()),$("#mbbgb-desc").text(a.getExplanationText()),$("#mbbgb-back").on("click",(function(){if(n.prevUrl&&n.prevUrl.length>0)return window.location.replace(n.prevUrl);if(window.history.length>1)return window.history.go(-1);let s;try{s=new URL(n.referrer)}catch(e){}e.tabs.query({currentWindow:!0,active:!0},(t=>{s?e.tabs.query({currentWindow:!0,url:`${s.origin}/*`},(s=>{s[0].index&&e.tabs.highlight({tabs:s[0].index},(()=>{t[0].id&&e.tabs.remove(t[0].id)}))})):t[0].id&&e.tabs.remove(t[0].id)}))})),$("#mbbgb-learn-even-more").prop("href",a.getExplanationLink()),$("#mbbgb-continue-once").on("click",o),e.runtime.sendMessage({type:"MSG_IS_NEEDING_NATIVE_MSG",parameters:{source:"blockPage"}},(t=>{e.runtime.lastError&&console.error("MBN: Chrome Runtime Failure: ",e.runtime.lastError),t&&t.needsIt&&($("#mbbgb-header-footer").animate({"max-height":"100%",opacity:1},800),s([{id:"nm-header",msg:"nativeMessagingHeader2"},{id:"nm-message",msg:"nativeMessagingMessage2"},{id:"decline-nm",msg:"buttonOptOut"},{id:"accept-nm",msg:"buttonOptIn"}]),[{id:"accept-nm",val:!0},{id:"decline-nm",val:!1}].forEach((({id:s,val:t})=>{document.getElementById(s).addEventListener("click",(async()=>{let s=t?await new Promise((s=>{e.permissions.request({permissions:["nativeMessaging"]},(e=>{console.log("MMPPNM: Permissions request resp: ",e),s(e)}))})):await new Promise((s=>{e.permissions.remove({permissions:["nativeMessaging"]},(e=>{e?(console.debug("MRNM: Successfully removed permissions"),s(!1)):(console.log("MRNM: Did not remove permissions... ",e),s(!0))}))}));e.runtime.sendMessage({type:"MSG_SETTINGS_SET",payload:{enableNativeMessaging:s}},(e=>{!e||e.error?console.error(e&&e.error):console.debug(`PR: Turned ${s?"on":"off"} Native Messaging`),document.getElementById("mbbgb-header-footer").style.display="none"}))}))})))}))}))})();